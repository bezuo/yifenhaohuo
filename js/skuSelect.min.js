function skuContent(t,a){var e="<section class='mask-box'></section><section class='skuBox anmite-show'><div class='commodity'><span class='fn-left commodity-img'><img src='http://gd3.alicdn.com/bao/uploaded/i3/TB1vqAkLXXXXXXAXXXXXXXXXXXX_!!0-item_pic.jpg_600x600.jpg' id='img' /></span><div class='commodity-tit-price'><h3 class='commodity-tit'>国行联保Canon/佳能微单相机EOS M2 18-55STM镜头eosm2单电数码</h3><em class='commodity-price'><span class='text-color'>¥<i id='price'>0.01</i></span></em></div></div><dl class='sku-control' id='sku-control'>"+t+"</dl><div class='buy-number'><span class='fn-right'>每人限购1件</span><em>数量：<i id='quatity'>1</i>件</em></div><span class='span-next'>下一步</span><input type='hidden' id='skuId'><input type='hidden' id='skuInfo'></section>";$("body").append(e),_ppathIdmap=a.data.ppathIdmap;var r=a.data.skuMap,s=JSON.stringify(_ppathIdmap);s=s.substring(1,s.length-1).replace(/\"/g,""),initSKU(skuArray(s,r));var n=$(".sku-control label");if(n)for(var i=0;i<n.length;i++)$(n[i]).clickSKU();$(".mask-box").get(0).addEventListener("tap",maskHide,!1)}function skuSelect(){0==$(".skuBox").length?$.ajax({type:"GET",url:"json/sku.json",dataType:"json",success:function(t){for(var a="",e=t.data.skuProps,r=0;r<e.length;r++){for(var s=e[r].values,n="",i="<dt data-item="+r+" data-value="+e[r].propId+">"+e[r].propName+"</dt>",l=0;l<s.length;l++)n+=s[l].imgUrl?"<label data-img="+s[l].imgUrl+" data-value="+s[l].valueId+">"+s[l].name+"</label>":"<label data-value="+s[l].valueId+">"+s[l].name+"</label>";a+=i+"<dd>"+n+"</dd>"}skuContent(a,t)},error:function(){alert("Ajax error!")}}):($(".mask-box").css("display","block"),$(".skuBox").removeClass("anmite-hide"))}function skuArray(t,a){var e={};arry=t.split(",");for(var r=0;r<arry.length;r++){arry[r]=arry[r].replace(/\;/g,",");var s=arry[r].lastIndexOf(":")+1;arry[r]=replacePos(arry[r],s,","),arry[r]=arry[r].split(",");for(var n=0;n<arry[r].length;n++){var i=arry[r][n].indexOf(":")+1;arry[r][n]=arry[r][n].substring(i,arry[r][n].length)}var l=arry[r][arry[r].length-1];arry[r]=arry[r].splice(0,arry[r].length-1).join(";"),e[arry[r]]=a[l]}return e}function replacePos(t,a,e){var r=t.substr(0,a-1)+e+t.substring(a,t.length);return r}function getObjKeys(t){if(t!==Object(t))throw new TypeError("Invalid object");var a=[];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(a[a.length]=e);return a}function add2SKUResult(t,a){var e=t.join(";");SKUResult[e]?(SKUResult[e].quatity+=a.quatity,SKUResult[e].prices.push(a.price)):SKUResult[e]={quatity:a.quatity,prices:[a.price]}}function initSKU(t){var a,e,r=getObjKeys(t);for(a=0;a<r.length;a++){var s=r[a],n=t[s],i=s.split(";");i.sort(function(t,a){return parseInt(t)-parseInt(a)});var l=arrayCombine(i);for(e=0;e<l.length;e++)add2SKUResult(l[e],n);SKUResult[i.join(";")]={quatity:n.quatity,prices:[n.price]}}}function arrayCombine(t){if(!t||!t.length)return[];for(var a=t.length,e=[],r=1;a>r;r++)for(var s=getFlagArrs(a,r);s.length;){for(var n=s.shift(),i=[],l=0;a>l;l++)n[l]&&i.push(t[l]);e.push(i)}return e}function getFlagArrs(t,a){if(!a||1>a)return[];var e,r,s,n=[],i=[],l=!1;for(e=0;t>e;e++)i[e]=a>e?1:0;for(n.push(i.concat());!l;)for(s=0,e=0;t-1>e;e++){if(1==i[e]&&0==i[e+1]){for(r=0;e>r;r++)i[r]=s>r?1:0;i[e]=0,i[e+1]=1;var o=i.concat();n.push(o),-1==o.slice(-a).join("").indexOf("0")&&(l=!0);break}1==i[e]&&s++}return n}!function(t){t.fn.clickSKU=function(){var a,e=t(this);oddImgURL=t("#img").attr("src");var r=function(){var r="",s="";if(!t(this).hasClass("disabled")){var n=e.attr("data-img");null!=n?e.hasClass("checked")?t("#img").attr("src",oddImgURL):t("#img").attr("src",n):!1,e.toggleClass("checked").siblings().removeClass("checked");var i=t(".checked");if(i.length){var l=[];i.each(function(){l.push(t(this).attr("data-value"))}),l.sort(function(t,a){return parseInt(t)-parseInt(a)});var o=l.length,c=SKUResult[l.join(";")].prices,u=Math.max.apply(Math,c),d=Math.min.apply(Math,c);t("#price").text(u>d?d+"-"+u:u),t("#quatity").text(SKUResult[l.join(";")].quatity),t(".sku-control label").not(i).not(e).each(function(){var a=t(this).siblings(".checked"),e=[];if(a.length)for(var r=a.attr("data-value"),s=0;o>s;s++)l[s]!=r&&e.push(l[s]);else e=l.concat();e=e.concat(t(this).attr("data-value")),e.sort(function(t,a){return parseInt(t)-parseInt(a)}),SKUResult[e.join(";")]?t(this).removeClass("disabled"):t(this).addClass("disabled")}),i.length==t("#sku-control dd").length?(t("<button class='btn-next' id='skuNext'>下一步</button>").insertBefore(".span-next"),t(".span-next").remove(),t("#skuNext").get(0).addEventListener("click",skuNext,!1)):(t("<span class='span-next'>下一步</span>").insertBefore(".btn-next"),t(".btn-next").remove())}else t("#price").text("0.01"),t(".sku-control label").each(function(){SKUResult[t(this).attr("data-value")]?t(this).removeClass("disabled"):t(this).addClass("disabled")})}t(".checked").each(function(){r+=t(this).parent("dd").prev().attr("data-value")+":"+t(this).attr("data-value")+";"}),r=r.substring(0,r.length-1),a=_ppathIdmap[r],t("#skuId").val(a),t(".checked").each(function(){var a=t(this).parent().prev().text(),e=t(this).text();s+=a+":"+e+"  "}),t("#skuInfo").val(s)};e.get(0).addEventListener("click",r,!1)}}(Zepto);var SKUResult={},_ppathIdmap;